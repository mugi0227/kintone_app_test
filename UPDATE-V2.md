# V2アップデート手順

お気に入り選択がうまく動作しない問題を解決するため、**V2版**を作成しました！

## 何が変わったの？

### V1（旧版）の問題
kintoneの標準ドロップダウンフィールドに選択肢を動的に追加する方法が、kintoneのバージョンによって動作しないことがありました。

### V2（新版）の改善点
- **HTMLの`<select>`要素を直接作成**する方式に変更
- kintoneのフィールドに依存せず、より確実に動作
- 選択肢の変更がリアルタイムに反映される
- スコアの即時更新機能を追加

---

## アップデート手順

### ステップ1: kintone側の変更

実は、kintone側は**変更不要**です！

今まで作成した以下のフィールドはそのまま使えます:
- お気に入り1, 2, 3（`favorite_1`, `favorite_2`, `favorite_3`）
- スコアフィールド（`score_tf`など）
- その他すべてのフィールド

**重要:** お気に入りフィールドは残しておいてください。削除する必要はありません。V2ではこれらのフィールドは使いませんが、削除するとエラーになる可能性があります。

### ステップ2: JavaScriptファイルを差し替え

1. kintoneアプリの設定画面を開く
2. 「JavaScript / CSSでカスタマイズ」をクリック
3. **既存の `career-anchor.js` を削除**
4. **新しい `career-anchor-v2.js` をアップロード**
5. `style.css`はそのまま（既に更新済み）
6. 「保存」→「アプリを更新」

### ステップ3: ブラウザのキャッシュをクリア

古いJavaScriptがキャッシュされている可能性があるので:

**Windows:** `Ctrl + Shift + R`
**Mac:** `Cmd + Shift + R`

で強制リロードしてください。

### ステップ4: テスト

1. 新規レコードを作成
2. Q1〜Q40まで回答
3. すべて回答すると、**HTMLで作成されたドロップダウン**が表示される
4. 3つ選択
5. **選択した瞬間にスコアが更新される**（保存前でも！）
6. 保存

---

## V2の動作確認ポイント

### 成功している場合
- [ ] 40問すべて回答すると、紫色のボックスが表示される
- [ ] その中に3つのドロップダウンが表示される
- [ ] ドロップダウンをクリックすると、高得点の質問が表示される
- [ ] 選択すると、リアルタイムでスコアが更新される
- [ ] 保存後、正しいキャリアタイプが表示される

### まだうまくいかない場合

#### デバッグ方法
1. **F12キー**を押して開発者ツールを開く
2. 「Console」タブを確認
3. エラーメッセージをコピーして教えてください

#### よくある問題

**Q: お気に入り選択が表示されない**
A: 以下を確認:
- 40問すべて回答したか？
- スペースフィールドの要素ID `favorites_container` が正しいか？
- コンソールにエラーが出ていないか？

**Q: スコアが更新されない**
A: 以下を確認:
- 数値フィールドのフィールドコードが正確か？
  - `score_tf`, `score_gm`, `score_au`, `score_se`, `score_ec`, `score_sv`, `score_ch`, `score_ls`
- コンソールにエラーが出ていないか？

**Q: ドロップダウンが表示されるが、選択肢が空**
A: これは起こらないはずですが、もし起きたら:
- ブラウザのキャッシュをクリア
- ページを完全にリロード
- コンソールのエラーを確認

---

## V2の技術的な詳細（興味がある方向け）

### 主な変更点

#### 1. お気に入り選択の実装方法
**V1:**
```javascript
// kintoneのドロップダウンフィールドの選択肢を変更
record[fieldCode].options = newOptions;
```

**V2:**
```javascript
// HTMLの<select>要素を直接作成
container.innerHTML = `<select id="favorite-select-1">...</select>`;
```

#### 2. データの保存方法
**V1:** kintoneのフィールドに保存
**V2:** JavaScript変数 `selectedFavorites` に保存 → 保存時にスコア計算に使用

#### 3. リアルタイム更新
V2では、ドロップダウン選択時に即座にスコアを再計算して画面に反映します。

---

## トラブルシューティング

### エラー: "record.score_tf is undefined"
→ スコアフィールドのフィールドコードを確認してください

### エラー: "Cannot read property 'value' of undefined"
→ 質問フィールドのフィールドコード（q1〜q40）を確認してください

### お気に入り選択が真っ白
→ ブラウザのキャッシュをクリアして、ページをリロードしてください

---

## サポート

うまく動作しない場合は、以下の情報を教えてください:
1. ブラウザのコンソールに表示されるエラーメッセージ
2. どの段階でうまくいかないか（質問表示、お気に入り表示、スコア計算など）
3. スクリーンショット（可能であれば）

一緒に解決していきましょう！
